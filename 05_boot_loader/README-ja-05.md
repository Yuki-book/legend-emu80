[Top README is here](../README-ja.md)
________________________________________________

legend-emu80
============

# Altair ブートローダー

## Description

『超マシン復活 #4 DEC TOPS-20 伝説の8080エミュレーターとALTAIR』
第7章に掲載の**Altair ブートローダー**です。
Altair simHで動作します。

## プログラム一覧

| No. | Source code | Explanation                            |
|:---:| ----------- | -------------------------------------- |
|  1  | bootpt.mac  | ブートストラップローダー               |


## ブートローダーのアセンブル（bootpt.mac）


```
   @ macro
   
   *bootpt,bootpt=bootpt
   
   NO ERRORS DETECTED
   
   PROGRAM BREAK IS 000000
   CPU TIME USED 00:00.071
   
   21P CORE USED   
   * ^Z
   @
```

### ブートローダーのリスト（bootpt.lst）

```
   @ type bootpt.lst
   BOOTPT - BOOT PTR     MACRO %53B(1254)-4 11:35 23-May-22 Page 1
   BOOTPT  MAC     23-May-22 11:34
   
                                              TITLE   BOOTPT - BOOT PTR
                                              SEARCH  ASM80,SYM80
                                              ENTRY   MAIN80
                                              .REQUIRE EMU80
                                              SALL
                           000140          BADR=140
                                              RADIX   10
                           000022          SIOCTL=18    ; SIO CONTROL
                           000023          SIODAT=19    ; SIO DATA
                                           ;-------------------- MAIN
           000000                              LOC  0
           000000  001000  000166              HLT
           000001  000000  000000              DW   0
           000002  000000  000000
           000003                          MAIN80:
           000003  002000  000076              MVI  A,3
           000004  000000  000003
           000005  002000  000323              OUT  SIOCTL  ; SIO INIT
           000006  000000  000022
           000007  002000  000076              MVI  A,8
           000010  000000  000010
           000011  002000  000323              OUT  SIOCTL  ; SIO SET
           000012  000000  000022
           000013  003000  000041              LXI  H,BADR
           000014  000000  000140
           000015  000000  000000
           000016  002000  000006              MVI  B,0
           000017  000000  000000
           000020                          LOOP:
           000020  003000  000021              LXI  D,0
           000021  000000  000000
           000022  000000  000000
           000023  001000  000353              XCHG
                                           ;
           000024                          LPGETD:
           000024  002000  000333              IN   SIOCTL  ; SIO STATUS
           000025  000000  000022
           000026  001000  000017              RRC
           000027  003000  000322              JNC  LPGETD
           000030  000000  000024
           000031  000000  000000
           000032  002000  000333              IN   SIODAT  ; SIO DATA
           000033  000000  000023
           000034  002000  000376              CPI  " "+1
           000035  000000  000041
           000036  003000  000332              JC   LPGETD
           000037  000000  000024
           000040  000000  000000
                                           ;
           000041  002000  000376              CPI  "0"
           000042  000000  000060
           000043  003000  000332              JC   EXGETD
           000044  000000  000065
           000045  000000  000000
           000046  002000  000376              CPI  "8"
   BOOTPT - BOOT PTR     MACRO %53B(1254)-4 11:35 23-May-22 Page 1-1
   BOOTPT  MAC     23-May-22 11:34
   
           000047  000000  000070
           000050  003000  000322              JNC  EXGETD
           000051  000000  000065
           000052  000000  000000
           000053  002000  000346              ANI  7
           000054  000000  000007
           000055  001000  000117              MOV  C,A
           000056  001000  000051              DAD  H
           000057  001000  000051              DAD  H
           000060  001000  000051              DAD  H
           000061  001000  000011              DAD  B
           000062  003000  000303              JMP  LPGETD
           000063  000000  000024
           000064  000000  000000
           000065                          EXGETD:
           000065  001000  000353              XCHG
           000066  001000  000163              MOV  M,E
           000067  001000  000043              INX  H
           000070  002000  000376              CPI  "$"
           000071  000000  000044
           000072  003000  000302              JNZ  LOOP
           000073  000000  000020
           000074  000000  000000
                                           ;
           000075  002000  000076              MVI  A,^O303 ; JMP
           000076  000000  000303
           000077  003000  000062              STA  0
           000100  000000  000000
           000101  000000  000000
           000102  003000  000041              LXI  H,BADR
           000103  000000  000140
           000104  000000  000000
           000105  003000  000042              SHLD 1
           000106  000000  000001
           000107  000000  000000
           000110  001000  000166              HLT
                                               END
   
   NO ERRORS DETECTED
   
   PROGRAM BREAK IS 000000
   CPU TIME USED 00:00.071
   
   21P CORE USED
   BOOTPT - BOOT PTR     MACRO %53B(1254)-4 11:35 23-May-22 Page S-1
   BOOTPT  MAC     23-May-22 11:34         SYMBOL TABLE
   
   A               000007
   ANI%OP          000346
   B               000000
   BADR            000140
   C               000001
   CPI%OP          000376
   D               000002
   DAD%OP          000001
   E               000003
   EXGETD          000065
   H               000004
   HLT%OP          000166
   IN%OP           000333
   INX%OP          000003
   JC%OP           000332
   JMP%OP          000303
   JNC%OP          000322
   JNZ%OP          000302
   LOOP            000020
   LPGETD          000024
   LXI%OP          000001
   M               000006
   MAIN80          000003  ent
   MOV%OP          000100
   MVI%OP          000006
   OUT%OP          000323
   RRC%OP          000017
   SHLD%O          000042
   SIOCTL          000022
   SIODAT          000023
   STA%OP          000062
   UUO1            001000
   UUO2            002000
   UUO3            003000
   XCHG%O          000353
   
   
   @
```

### ブートローダーのオブジェクトコード

```
    000000  166 ;  HLT
    000001  000 ;  DW   0
    000002  000 ; 
    000003  076 ;  MVI  A,3
    000004  003 ; 
    000005  323 ;  OUT  SIOCTL
    000006  022 ; 
    000007  076 ;  MVI  A,8
    000010  010 ; 
    000011  323 ;  OUT  SIOCTL
    000012  022 ; 
    000013  041 ;  LXI  H,BADR
    000014  140 ; 
    000015  000 ; 
    000016  006 ;  MVI  B,0
    000017  000 ; 
    000020  021 ;  LXI  D,0
    000021  000 ; 
    000022  000 ; 
    000023  353 ;  XCHG
    000024  333 ;  IN   SIOCTL
    000025  022 ; 
    000026  017 ;  RRC
    000027  322 ;  JNC  LPGETD
    000030  024 ; 
    000031  000 ; 
    000032  333 ;  IN   SIODAT
    000033  023 ; 
    000034  376 ;  CPI  " "+1
    000035  041 ; 
    000036  332 ;  JC   LPGETD
    000037  024 ; 
    000040  000 ; 
    000041  376 ;  CPI  "0"
    000042  060 ; 
    000043  332 ;  JC   EXGETD
    000044  065 ; 
    000045  000 ; 
    000046  376 ;  CPI  "8"
    000047  070 ; 
    000050  322 ;  JNC  EXGETD
    000051  065 ; 
    000052  000 ; 
    000053  346 ;  ANI  7
    000054  007 ; 
    000055  117 ;  MOV  C,A
    000056  051 ;  DAD  H
    000057  051 ;  DAD  H
    000060  051 ;  DAD  H
    000061  011 ;  DAD  B
    000062  303 ;  JMP  LPGETD
    000063  024 ; 
    000064  000 ; 
    000065  353 ;  XCHG
    000066  163 ;  MOV  M,E
    000067  043 ;  INX  H
    000070  376 ;  CPI  "$"
    000071  044 ; 
    000072  302 ;  JNZ  LOOP
    000073  020 ; 
    000074  000 ; 
    000075  076 ;  MVI  A,^O303
    000076  303 ; 
    000077  062 ;  STA  0
    000100  000 ; 
    000101  000 ; 
    000102  041 ;  LXI  H,BADR
    000103  140 ; 
    000104  000 ; 
    000105  042 ;  SHLD 1
    000106  001 ; 
    000107  000 ; 
    000110  166 ;  HLT
```

