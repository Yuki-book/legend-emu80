[TOP README](../README-ja.md)

# 8080数式電卓

## Description

『超マシン復活 #4 DEC TOPS-20 伝説の8080エミュレーターとALTAIR』
第5章に掲載の**8080数式電卓**です。
PDP-10 TOPS-20で動作します。
アセンブラで生成した8080オブジェクトコードの数式電卓は、
Altair simHでも動作します。

## プログラム一覧

| No. | Source code | Explanation                            |
|:---:| ----------- | -------------------------------------- |
|  1  | calsym.mac  | 電卓シンボルUNV定義                    |
|  2  | calm80.mac  | 数式電卓メイン                         |
|  3  | calopl.mac  | 演算ライブラリ                         |
|  4  | caliol.mac  | 入出力ライブラリ                       |
|  5  | caliob.mac  | 基本入出力（PDP-10用）                 |
|  6  | caliop.mac  | 基本入出力（Altair用）                 |
|  7  | caldat.mac  | データ領域定義                         |


## アセンブル

### UNV定義のアセンブル （calsym.mac）

| No. | Source code | Explanation                            |
|:---:| ----------- | -------------------------------------- |
|  1  | calsym.mac  | 電卓シンボルUNV定義           |

```
   @ macro
   
   *calsym,calsym=calsym
   
   NO ERRORS DETECTED
   
   PROGRAM BREAK IS 000000
   CPU TIME USED 00:00.039
   
   21P CORE USED
   
   * ^Z
   @
```

### 数式電卓（calm80.mac ,calopl.mac ,caliol.mac ,caliob.mac ,caldat.mac）

| No. | Source code | Explanation                            |
|:---:| ----------- | -------------------------------------- |
|  1  | calm80.mac  | 数式電卓メイン                         |
|  2  | calopl.mac  | 演算ライブラリ                         |
|  3  | caliol.mac  | 入出力ライブラリ                       |
|  4  | caliob.mac  | 基本入出力（PDP-10用）                 |
|  5  | caldat.mac  | データ領域定義                         |


```
   @ macro
   *calm80,calm80=calm80
   
   NO ERRORS DETECTED
   
   PROGRAM BREAK IS 001332
   CPU TIME USED 00:00.661
   
   31P CORE USED
   
   *calopl,calopl=calopl
   
   NO ERRORS DETECTED
   
   PROGRAM BREAK IS 001237
   CPU TIME USED 00:00.517
   
   28P CORE USED
   
   *caliol,caliol=caliol
   
   NO ERRORS DETECTED
   
   PROGRAM BREAK IS 000201
   CPU TIME USED 00:00.140
   
   22P CORE USED
   
   *caliob,caliob=caliob
   
   NO ERRORS DETECTED
   
   PROGRAM BREAK IS 000025
   CPU TIME USED 00:00.078
   
   58P CORE USED
   
   *caldat,caldat=caldat
   
   NO ERRORS DETECTED
   
   PROGRAM BREAK IS 001704
   CPU TIME USED 00:00.016
   
   57P CORE USED
   
   * ^Z
   @
```


### 8080数式電卓の実行


```
   @ exec calm80.mac,calopl.mac,caliol.mac,caliob.mac,caldat.mac
   
   LINK:   Loading
   [LNKXCT EMU80 execution]
   EMU8080 START
   Formula calculator start!
   ? 2+3*4
                   ANSER=14 [000E]
   ? 100/11
                   ANSER=9 [0009]
   ? 100%11
                   ANSER=1 [0001]
   ? 100-(100/11*11)
                   ANSER=1 [0001]
   ?   Goodbye
   
   HALT!
   @
```

### Altair用 数式電卓（calm80.mac ,calopl.mac ,caliol.mac ,caliop.mac ,caldat.mac）

| No. | Source code | Explanation                            |
|:---:| ----------- | -------------------------------------- |
|  1  | calm80.mac  | 数式電卓メイン                         |
|  2  | calopl.mac  | 演算ライブラリ                         |
|  3  | caliol.mac  | 入出力ライブラリ                       |
|  4  | caliop.mac  | 基本入出力（Altair用）                 |
|  5  | caldat.mac  | データ領域定義                         |

caliob.mac（基本入出力 PDP-10用）をcaliop.mac（基本入出力 Altair用）に
変更するとAltairで動作する8080コードを生成します。

エンハンスド・エミュレーターを使用するとPDP-10でも動作します。

```
   @ exec calm80.mac,calopl.mac,caliol.mac,caliop.mac,caldat.mac
   
   LINK:   Loading
   [LNKXCT EMU80 execution]
   EMU8080 START
   Formula calculator start!
   ? 2+3*4
                   ANSER=14 [000E]
   ? 100/11
                   ANSER=9 [0009]
   ? 100%11
                   ANSER=1 [0001]
   ? 100-(100/11*11)
                   ANSER=1 [0001]
   ?   Goodbye
   
   HALT!
   @
```

### Altair用 数式電卓のオブジェクトコード出力

```
   @ exec calm80.mac,calopl.mac,caliol.mac,caliop.mac,caldat.mac
   LINK:   Loading
   [LNKXCT EMU80 execution]
   EMU8080 START
   Formula calculator start!
   ?
   Goodbye
   
   HALT!
   @@continue
   OBJ8080 START
   CALC.PTR  S: 00140  E: 03143
   DONE
   @
```

### Altair用 数式電卓のオブジェクトコードの確認

```
   @ type calc.ptr
   061,340,012,315,066,006,041,340,
   010,021,340,007,315,115,003,021,
   204,001,315,256,005,016,372,041,
   146,006,021,201,001,315,370,005,
   041,146,006,315,227,002,315,233,
   002,062,336,001,376,376,312,250,
   000,315,340,001,072,336,001,376,
   376,302,257,000,315,206,003,302,
   264,000,315,263,001,303,165,000,
   021,251,001,315,256,005,166,076,
   020,303,264,000,107,021,363,000,
   346,001,302,355,000,021,012,001,
   170,346,002,302,355,000,021,040,
   001,170,346,004,302,355,000,021,
   063,001,170,346,010,302,355,000,
   021,110,001,170,346,020,302,355,
   000,021,135,001,170,346,040,302,
   355,000,021,164,001,315,256,005,
   303,256,000,056,056,040,123,124,
   101,103,113,040,125,116,104,105,
   122,106,114,117,127,040,041,015,
   012,000,056,056,040,123,124,101,
   103,113,040,117,126,105,122,106,
   114,117,127,040,041,015,012,000,
   056,056,040,132,105,122,117,040,
   104,111,126,111,104,105,040,041,
   015,012,000,056,056,040,103,101,
   114,103,040,117,126,105,122,106,
   114,117,127,040,041,015,012,000,
   056,056,040,114,105,130,111,103,
   101,114,040,105,122,122,117,122,
   040,041,015,012,000,056,056,040,
   123,131,116,124,101,103,124,111,
   103,040,105,122,122,117,122,040,
   041,015,012,000,056,056,040,105,
   122,122,117,122,040,041,015,012,
   000,077,040,000,106,157,162,155,
   165,154,141,040,143,141,154,143,
   165,154,141,164,157,162,040,163,
   164,141,162,164,041,015,012,000,
   011,011,101,116,123,105,122,075,
   000,107,157,157,144,142,171,145,
   015,012,000,021,240,001,315,256,
   005,021,140,007,325,315,105,005,
   076,040,022,023,076,133,022,023,
   315,042,005,076,135,022,023,076,
   015,022,023,076,012,022,023,257,
   022,321,315,256,005,311,376,351,
   315,013,002,072,336,001,041,256,
   003,376,203,312,367,001,041,343,
   003,376,204,312,367,001,311,345,
   315,233,002,062,336,001,315,013,
   002,341,315,337,001,302,264,000,
   303,343,001,315,076,002,072,336,
   001,041,377,003,376,200,312,052,
   002,041,152,004,376,201,312,052,
   002,041,157,004,376,202,312,052,
   002,311,345,315,233,002,062,336,
   001,315,076,002,341,315,337,001,
   302,264,000,303,016,002,072,336,
   001,376,204,312,112,002,315,132,
   002,311,315,233,002,062,336,001,
   315,132,002,315,363,003,302,264,
   000,311,072,336,001,376,377,312,
   152,002,376,205,312,172,002,303,
   222,002,052,013,003,315,131,003,
   302,264,000,315,233,002,062,336,
   001,311,315,233,002,062,336,001,
   315,340,001,072,336,001,376,206,
   302,222,002,315,233,002,062,336,
   001,311,076,040,303,264,000,042,
   015,003,311,325,345,052,015,003,
   315,324,002,042,015,003,176,376,
   015,076,376,312,321,002,353,315,
   347,004,332,304,002,302,264,000,
   042,013,003,353,042,015,003,076,
   377,303,321,002,353,116,043,042,
   015,003,315,344,002,302,321,002,
   171,341,321,311,176,315,335,002,
   300,043,303,324,002,376,011,310,
   376,040,310,311,345,305,171,062,
   012,003,041,003,003,016,200,276,
   312,370,002,043,014,303,357,002,
   171,376,207,302,377,002,257,301,
   341,247,311,052,057,045,053,055,
   050,051,000,000,000,146,006,365,
   175,057,157,174,057,147,043,361,
   311,305,006,000,174,265,312,054,
   003,114,315,017,003,174,251,372,
   054,003,006,010,170,247,301,311,
   076,200,244,107,374,031,003,247,
   311,175,027,157,174,027,147,311,
   174,037,147,175,037,157,311,340,
   007,340,010,340,010,042,113,003,
   042,111,003,353,042,107,003,353,
   311,325,345,315,166,003,322,146,
   003,076,002,303,162,003,353,052,
   111,003,053,162,053,163,042,111,
   003,257,341,321,247,311,345,052,
   107,003,353,052,111,003,053,053,
   175,223,174,232,341,311,325,315,
   241,003,322,222,003,076,001,303,
   236,003,052,111,003,136,043,126,
   043,042,111,003,353,257,321,247,
   311,052,113,003,353,052,111,003,
   175,223,174,232,077,311,315,206,
   003,300,353,315,206,003,300,315,
   302,003,107,315,131,003,300,170,
   247,311,174,346,200,037,107,172,
   346,200,260,037,107,031,174,346,
   200,260,006,000,376,140,312,336,
   003,376,200,302,340,003,006,010,
   170,247,311,315,206,003,300,315,
   031,003,300,315,131,003,300,315,
   256,003,311,315,206,003,300,315,
   031,003,300,315,131,003,311,315,
   206,003,300,353,315,206,003,300,
   315,031,004,312,021,004,041,377,
   177,107,315,131,003,300,170,247,
   311,353,315,060,003,300,110,353,
   315,060,003,300,171,250,062,075,
   004,102,113,353,315,117,004,315,
   076,004,300,353,072,075,004,247,
   374,031,003,247,311,000,006,010,
   172,247,372,114,004,174,265,302,
   114,004,006,000,170,247,311,041,
   000,000,076,020,365,173,037,322,
   133,004,011,247,315,100,003,353,
   315,100,003,353,361,075,302,124,
   004,311,076,001,303,161,004,076,
   002,062,226,004,315,206,003,300,
   353,315,206,003,300,315,227,004,
   107,312,207,004,041,000,000,072,
   226,004,075,312,217,004,353,315,
   131,003,300,170,247,311,000,173,
   262,076,004,312,274,004,353,315,
   060,003,300,110,353,315,060,003,
   300,171,250,062,075,004,102,113,
   353,315,276,004,353,072,075,004,
   247,374,031,003,247,311,140,151,
   315,017,003,104,115,041,000,000,
   076,020,365,247,353,315,071,003,
   353,315,071,003,325,124,135,257,
   011,332,336,004,142,153,321,213,
   137,361,075,302,312,004,311,041,
   000,000,032,315,030,005,330,104,
   115,325,026,000,137,257,051,027,
   051,027,011,027,051,027,031,027,
   321,247,302,024,005,174,247,372,
   024,005,023,032,315,030,005,322,
   357,004,257,311,076,010,247,311,
   376,060,330,376,072,077,330,346,
   017,311,365,305,345,016,004,257,
   051,027,051,027,051,027,051,027,
   376,012,372,071,005,326,012,306,
   021,306,060,022,023,015,302,047,
   005,341,301,361,311,365,305,345,
   174,247,362,124,005,315,017,003,
   076,055,022,023,042,176,005,041,
   200,005,006,360,325,136,043,126,
   043,345,052,176,005,315,213,005,
   042,176,005,341,321,315,230,005,
   312,165,005,022,023,176,247,302,
   134,005,341,301,361,311,000,000,
   360,330,030,374,234,377,366,377,
   377,377,000,016,057,014,031,332,
   215,005,353,315,017,003,031,311,
   170,200,107,322,253,005,171,376,
   060,312,251,005,006,000,303,253,
   005,016,000,171,247,311,365,032,
   023,247,312,273,005,315,077,006,
   303,257,005,361,311,305,345,257,
   315,355,005,006,001,315,123,006,
   376,012,312,305,005,315,077,006,
   167,043,376,015,302,335,005,001,
   001,000,303,345,005,376,177,302,
   345,005,001,001,377,015,302,305,
   005,170,341,301,311,305,345,167,
   043,015,302,357,005,341,301,311,
   365,305,325,345,325,315,256,005,
   315,275,005,321,247,312,032,006,
   325,247,021,057,006,372,023,006,
   021,050,006,315,256,005,321,303,
   374,005,021,045,006,315,256,005,
   341,321,301,361,311,015,012,000,
   040,077,077,077,015,012,000,040,
   130,130,130,015,012,000,076,003,
   323,020,076,010,323,020,311,365,
   305,325,345,117,333,020,346,002,
   312,104,006,171,323,021,341,321,
   301,361,311,305,325,345,117,333,
   020,346,001,312,127,006,333,021,
   341,321,301,311$
   @
```
